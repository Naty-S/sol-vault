# SOL Vault

Vault anchor program for SOL

This program creates wallets to store SOL for the user, like a saving account.

## Concepts

**Vault**: PDA owned by our program where the user can deposit and withdraw tokens.

>Kind of a wallet.

**seeds**: Allows the creation of PDA in a way that they can be always known (deterministic).

>Allows the derivation to be cryptographically verified when signing ixs.

**Canonical bump**: 1st bump that generates an address out of the eliptic curve (PDA).

>From 255 to 0.

**Space**: Trait to tell anchor how much space needs to be allocated for the account.

>Needs the anchor discriminator

**Anchor discriminator**: Account discriminator that Anchor uses to index the accounts,
makes it easier to find it on instructions.
The 1st 8 bytes of the hashed account name (a string).

>Value: `usize` 8.

**'info**: Lifetime. Ensures the context accounts will remain in memory (be accessible)
during the execution of the instruction that uses the context.

>Tells Rust "Hey keep this, I need it thru 'X' instrcuction".

**Account**: Accounts owned by the program (PDA's).

**SystemAccount**: Used when storing data is not needed, can just to store lamports.

**system_program**: The only that can create accounts, transfer lamports.

**InitializeBumps**: Autogenerated context (Initialize) bumps by Anchor.

>Naming syntax: [Name of the context]Bumps

**cpi**: Cross Program Invocation.

**CpiContext::new**: Creates cpi context knowing the signature (inherited from tx) of the signer (user).

**CpiContext::new_with_signer**: Creates cpi context with the signer seeds to create the signature unkown at runtime.

**close**: Account constraint that zeroes out the data and transfers all the lamports out.

>Only works if the program owns the account (pda)

## Functions

- Create vault account (initialize)
- Deposit SOL
- Withdraw SOL
- Close vault account

## Macros

- `#![allow(unexpected_cfgs)]`: Allows the macro definition for Solana programs.
- `#![allow(deprecated)]`: Allows the use of `realoc` deprecated method.
- `#[program]`: Allows the definition of a Solana program module.
- `#[derive(Accounts)]`: Allows the definition of an instruction context. Endpoints.
- `#[account]`: Allows the definition of a Solana account.
- `#[derive(InitSpace)]`: Implements Space trait for the account without anchor discriminator.

## Important notes

At deposit
>The Program doesn't sign 'cuz when starting a tx user sign and program knows that.
>
>The user signature is in whole process of the tx, no matter how many cpi the program does.
>
>A runtime thing
>
>*This is what makes wallet dryners to work*.

After account initialization
>The Program doesn't need to recalculate the bumps over again every time (try to find),
>so it can create them with the same seeds and already calculated canonical bump.

At withdraw
>The Program doesn't know the signature of the signer (vault), so it has to
>create it for the cpi context with the seeds saved in the vault state and bump.
>
>The vault can sign because as the user is the only one that request the withdrawal, then
>'cuz the seed used has the `vault_state` and this has the user in its seeds, then the
>program can know who the user is and create the signature.

Closing
>The account remains there until the garbage collector wipe out all accounts with no lamports
>(even if they have data) at the end of every epoch.
